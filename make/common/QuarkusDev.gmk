QUARKUS_HOME ?= $(HOME)/src/quarkus
QUARKUS_VERSION ?= 999-SNAPSHOT
TEST_MODULE ?= main

q_mvnw_cmd += JAVA_HOME=$(opt)/java-17
q_mvnw_cmd += ./mvnw

quarkus_arc_jar = $(QUARKUS_HOME)/independent-projects/arc/runtime/target/arc-$(QUARKUS_VERSION).jar
$(quarkus_arc_jar): $(shell find $(QUARKUS_HOME)/independent-projects/arc -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_arc_jar): $(shell find $(QUARKUS_HOME)/independent-projects/arc -type f -name '*.xml' | grep -v '/target/' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f independent-projects/arc install
> touch $@

build-quarkus-arc: $(quarkus_arc_jar)
.PHONY: build-quarkus-arc

quarkus_core_jar = $(QUARKUS_HOME)/core/deployment/target/quarkus-core-deployment-$(QUARKUS_VERSION).jar
$(quarkus_core_jar): $(shell find $(QUARKUS_HOME)/core -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_core_jar): $(shell find $(QUARKUS_HOME)/core -type f -name 'pom.xml' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f core install
> touch $@

quarkus_devtools_jar = $(QUARKUS_HOME)/devtools/cli/target/quarkus-cli-$(QUARKUS_VERSION).jar
$(quarkus_devtools_jar): $(shell find $(QUARKUS_HOME)/devtools -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_devtools_jar): $(shell find $(QUARKUS_HOME)/devtools -type f -name '*.xml' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f devtools install
> touch $@

quarkus_awt_jar = $(QUARKUS_HOME)/extensions/awt/deployment/target/quarkus-awt-deployment-$(QUARKUS_VERSION).jar
$(quarkus_awt_jar): $(shell find $(QUARKUS_HOME)/extensions/awt -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_awt_jar): $(shell find $(QUARKUS_HOME)/extensions/awt -type f -name 'pom.xml' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f extensions/awt install
> touch $@

quarkus_netty_jar = $(QUARKUS_HOME)/extensions/netty/deployment/target/quarkus-netty-deployment-$(QUARKUS_VERSION).jar
$(quarkus_netty_jar): $(shell find $(QUARKUS_HOME)/extensions/netty -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_netty_jar): $(shell find $(QUARKUS_HOME)/extensions/netty -type f -name 'pom.xml' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f extensions/netty install
> touch $@

quarkus_jackson_jar = $(QUARKUS_HOME)/extensions/jackson/deployment/target/quarkus-jackson-deployment-$(QUARKUS_VERSION).jar
$(quarkus_jackson_jar): $(shell find $(QUARKUS_HOME)/extensions/jackson -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_jackson_jar): $(shell find $(QUARKUS_HOME)/extensions/jackson -type f -name 'pom.xml' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f extensions/jackson install
> touch $@

quarkus_kafka_client_jar = $(QUARKUS_HOME)/extensions/kafka-client/deployment/target/quarkus-kafka-client-deployment-$(QUARKUS_VERSION).jar
$(quarkus_kafka_client_jar): $(shell find $(QUARKUS_HOME)/extensions/kafka-client -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_kafka_client_jar): $(shell find $(QUARKUS_HOME)/extensions/kafka-client -type f -name 'pom.xml' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f extensions/kafka-client install
> touch $@

quarkus_resteasy_reactive_jar = $(QUARKUS_HOME)/extensions/resteasy-reactive/rest/deployment/target/quarkus-rest-deployment-$(QUARKUS_VERSION).jar
$(quarkus_resteasy_reactive_jar): $(shell find $(QUARKUS_HOME)/extensions/resteasy-reactive -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_resteasy_reactive_jar): $(shell find $(QUARKUS_HOME)/extensions/resteasy-reactive -type f -name 'pom.xml' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f extensions/resteasy-reactive install
> touch $@

quarkus_security_jar = $(QUARKUS_HOME)/extensions/security/deployment/target/quarkus-security-deployment-$(QUARKUS_VERSION).jar
$(quarkus_security_jar): $(shell find $(QUARKUS_HOME)/extensions/security -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_security_jar): $(shell find $(QUARKUS_HOME)/extensions/security -type f -name 'pom.xml' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f extensions/security install
> touch $@

quarkus_spring_data_jpa_jar = $(QUARKUS_HOME)/extensions/kafka-client/deployment/target/quarkus-spring-data-jpa-deployment-$(QUARKUS_VERSION).jar
$(quarkus_spring_data_jpa_jar): $(shell find $(QUARKUS_HOME)/extensions/spring-data-jpa -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_spring_data_jpa_jar): $(shell find $(QUARKUS_HOME)/extensions/spring-data-jpa -type f -name 'pom.xml' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f extensions/spring-data-jpa install
> touch $@

quarkus_undertow_jar = $(QUARKUS_HOME)/extensions/undertow/deployment/target/quarkus-undertow-deployment-$(QUARKUS_VERSION).jar
$(quarkus_undertow_jar): $(shell find $(QUARKUS_HOME)/extensions/undertow -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_undertow_jar): $(shell find $(QUARKUS_HOME)/extensions/undertow -type f -name 'pom.xml' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f extensions/undertow install
> touch $@

quarkus_tools_jar = $(QUARKUS_HOME)/independent-projects/tools/analytics-common/target/quarkus-analytics-common-$(QUARKUS_VERSION).jar
$(quarkus_tools_jar): $(shell find $(QUARKUS_HOME)/independent-projects/tools -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_tools_jar): $(shell find $(QUARKUS_HOME)/independent-projects/tools -type f -name '*.xml' | grep -v '/target/' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f independent-projects/tools install
> touch $@

quarkus_test_common_jar = $(QUARKUS_HOME)/test-framework/common/target/quarkus-test-common-$(QUARKUS_VERSION).jar
$(quarkus_test_common_jar): $(shell find $(QUARKUS_HOME)/test-framework/common -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_test_common_jar): $(shell find $(QUARKUS_HOME)/test-framework/common -type f -name '*.xml' | grep -v '/target/' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f test-framework/common install
> touch $@

quarkus_test_maven_jar = $(QUARKUS_HOME)/test-framework/maven/target/quarkus-test-maven-$(QUARKUS_VERSION).jar
$(quarkus_test_maven_jar): $(shell find $(QUARKUS_HOME)/test-framework/maven -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_test_maven_jar): $(shell find $(QUARKUS_HOME)/test-framework/maven -type f -name '*.xml' | grep -v '/target/' | sed 's: :\\ :g')
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f test-framework/maven install
> touch $@

quarkus_junit5_jar = $(QUARKUS_HOME)/test-framework/junit5/target/quarkus-junit5-$(QUARKUS_VERSION).jar
$(quarkus_junit5_jar): $(shell find $(QUARKUS_HOME)/test-framework/junit5 -type f -name '*.java' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_junit5_jar): $(shell find $(QUARKUS_HOME)/test-framework/junit5 -type f -name '*.xml' | grep -v '/target/' | sed 's: :\\ :g')
$(quarkus_junit5_jar): $(quarkus_test_common_jar)
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -DskipTests -f test-framework/junit5 install
> touch $@

build-quarkus: $(java)
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) -Dquickly
.PHONY: build-quarkus

clean-quarkus: $(java)
> cd $(QUARKUS_HOME)
> $(q_mvnw_cmd) clean
.PHONY: clean-quarkus

#test_args += $(HOME)/opt/maven/bin/mvnDebug
test_args += ./mvnw
test_args += -Dnative
test_args += -Dnative.surefire.skip
test_args += -Dformat.skip
test_args += -Dno-descriptor-tests
test_args += -DskipDocs
test_args += --fail-at-end
test_args += -Dquarkus.native.container-build=false
#test_args += -Dquarkus.native.additional-build-args=-H:+PrintClassInitialization
#test_args += -Dquarkus.native.additional-build-args=--debug-attach=*:8000
#test_args += -Dquarkus.native.additional-build-args=--trace-object-instantiation=jdk.nio.zipfs.ZipFileSystemProvider
test_args += -f
test_args += integration-tests/$(TEST_MODULE)

test-quarkus: $(java)
test-quarkus: $(quarkus_awt_jar)
test-quarkus: $(quarkus_core_jar)
test-quarkus: $(quarkus_security_jar)
test-quarkus: $(quarkus_spring_data_jpa_jar)
> cd $(QUARKUS_HOME)
> JAVA_HOME=$(GRAALVM_HOME) $(test_args) install
.PHONY: test-quarkus
